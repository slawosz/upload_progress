<html>
  <head>
    <title>Super Upload</title>
    <script language="javascript" type="text/javascript">
      var progressUpdater;
      var formActionUrl = 'http://slawosz.com:8080/upload?uid='

      function submitForm(form) {
        uid = setUid();
        form.action = formActionUrl + uid;
        form.submit();
        traceProgress(uid);
      }

      function traceProgress(uid) {
        displayPercent(0);
        checkProgress(uid);
        progressUpdater = setInterval( 
          function() {
            checkProgress(uid);
          },
          1000
        )
      }

      function checkProgress(uid) {
        xhr = new XMLHttpRequest();
        xhr.open('GET','http://slawosz.com:8080/progress?uid=' + uid, true);
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4) {
            displayPercent(xhr.responseText);
          }
        }
        xhr.send()
      }

      function displayPercent(value) {
        document.getElementById('progress').innerHTML = 'Status: ' + value + '%';
      }

      function setUid() {
        return new Date().getTime();
      }
    </script>
  </head>
  <body>
    <form target='uploader' enctype="multipart/form-data" method="post">
      <input type="file" name="files" onChange="submitForm(this.form)"><BR>
    </form>
    <div id="link"></div>
    <div id="progress">
      Select file to start upload.
    </div>
    <iframe name='uploader' style='display: none'/>
  </body>
</html>
